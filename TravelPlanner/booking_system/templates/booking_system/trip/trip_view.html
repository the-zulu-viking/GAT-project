{% extends "base.html" %}

{% block body %}
<div class="container mt-5">
  <div class="card shadow-lg border-0">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="card-title m-0">{{ trip.name }}</h2>
        <div class="d-flex gap-2">
          <a href="{% url 'trips_overview' %}" class="btn btn-outline-secondary">
            ‚Üê Back to Trips
          </a>
          <a href="{% url 'edit_trip' trip.id %}" class="btn btn-primary">
            <i class="bi bi-pencil-square"></i> Edit Trip
          </a>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <p><strong>Start Date:</strong> {{ trip.start_date }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>End Date:</strong> {{ trip.end_date }}</p>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <p><strong>Duration:</strong> {{ trip.duration }} nights</p>
        </div>
        <div class="col-md-6">
          <p><strong>Number of Guests:</strong> {{ trip.number_of_guests }}</p>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <p><strong>Payment Status:</strong>
            <span class="badge bg-info text-dark">{{ trip.payment_status }}</span>
          </p>
        </div>
        <div class="col-md-6">
          <p><strong>Trip Status:</strong>
            <span class="badge bg-primary">{{ trip.trip_status }}</span>
          </p>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <p><strong>Generated By:</strong> {{ trip.generated }}</p>
        </div>
        <div class="col-md-6">
          {% if trip.agent %}
          <p><strong>Agent:</strong> {{ trip.agent }}</p>
          {% endif %}
        </div>
      </div>


      <div class="row mb-3">
        {% if trip.no_consultant %}
        <div class="col-md-6">
          <p><strong>Consultant (NO):</strong> {{ trip.no_consultant }}</p>
        </div>
        {% endif %}
        {% if trip.sa_consultant %}
        <div class="col-md-6">
          <p><strong>Consultant (SA):</strong> {{ trip.sa_consultant }}</p>
        </div>
        {% endif %}
      </div>

      <div class="accordion mb-4" id="tripDetailsAccordion">

        <!-- Guests Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingGuests">
            <button class="accordion-button collapse show" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseGuests" aria-expanded="true" aria-controls="collapseGuests">
              Guests
            </button>
          </h2>
          <div id="collapseGuests" class="accordion-collapse collapse show" aria-labelledby="headingGuests" >
            <div class="accordion-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="m-0">Guests</h4>
                <a href="{% url 'trip_guest_search' trip.id 0 %}" class="btn btn-sm btn-outline-primary">Edit Guests</a>
              </div>
              
              {% if trip.guests.exists %}
              <ul class="list-group mb-3">
                {% for guest in trip.guests.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ guest }}
                </li>
                {% endfor %}
              </ul>
              {% else %}
              <p class="text-muted mb-3">No guests added yet.</p>
              <a href="{% url 'trip_guest_search' trip.id 0 %}" class="btn btn-sm btn-outline-primary">Add Guests</a>
              {% endif %}
            </div>
          </div>
        </div>
      
        <!-- Flights Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFlights">
            <button class="accordion-button collapse show" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseFlights" aria-expanded="true" aria-controls="collapseFlights">
              Flights
            </button>
          </h2>
          <div id="collapseFlights" class="accordion-collapse collapse show" aria-labelledby="headingFlights" >
            <div class="accordion-body">
              {% if flights %}
                {% include "booking_system/partials/flight_table.html" %}
              {% else %}
                <p class="text-muted mb-3">No flights added yet.</p>
                <a href="{% url 'trip_add_flights' trip.id %}" class="btn btn-sm btn-outline-primary">Add Flights</a>
              {% endif %}
            </div>
          </div>
        </div>
      
        <!-- Accommodations Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingAccommodations">
            <button class="accordion-button collapse show" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseAccommodations" aria-expanded="true" aria-controls="collapseAccommodations">
              Accommodations
            </button>
          </h2>
          <div id="collapseAccommodations" class="accordion-collapse collapse show" aria-labelledby="headingAccommodations">
            <div class="accordion-body">
              {% if accommodations %}
              {% include "booking_system/partials/accommodation_table.html" %}
            {% else %}
              <p class="text-muted mb-3">No accommodations added yet.</p>
              <a href="{% url 'trip_add_accommodations' trip.id %}" class="btn btn-sm btn-outline-primary">Add Accommodations</a>
            {% endif %}
            
            </div>
          </div>
        </div>
      
      </div>
      
      <hr>

      {% if trip.note %}
      <hr>
      <div class="alert alert-secondary" role="alert">
        <strong>Note:</strong><br>{{ trip.note|linebreaks }}
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
